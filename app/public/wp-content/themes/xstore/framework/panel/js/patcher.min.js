window.et_panel=window.et_panel||{},function(e){e(document).ready(function(a){var n={successfully_applied:!1,patches_wrapper:a(".etheme-patcher-table-wrapper"),patch_action_all:function(t){a.ajax({url:XStorePanelPatcherConfig.ajaxurl,method:"POST",data:{action:"xstore_apply_patch_all",theme_version:t.data("theme_version"),test_mode:XStorePanelPatcherConfig.test_mode,_nonce:XStorePanelPatcherConfig.nonce},dataType:"json",beforeSend:function(){},complete:function(e){n.patches_wrapper.removeClass("loading"),t.removeClass("loading"),n.successfully_applied&&!XStorePanelPatcherConfig.test_mode&&setTimeout(function(){window.location.reload()},2e3)},success:function(e){e.errors.server_errors?alert(e.server_errors_text+"\n"+e.errors.server_errors.join("\n")):(e.success_patches.forEach(function(e,t){n.patches_wrapper.find('[data-patch_id="'+e+'"]').parent().html(XStorePanelPatcherConfig.applied_btn).parent().removeClass("patch-test-mode")}),e.success?n.successfully_applied=!0:(e.errors.forEach(function(e,t){n.patches_wrapper.find('[data-patch_id="'+e.replace("#","")+'"]').parent().html(XStorePanelPatcherConfig.error_btn).parent().removeClass("patch-error")}),e.status&&"success"!=e.status?alert(e.message):e.errors.length?confirm(e.errors_text+"\n"+e.errors.join("\n"))&&(window.location.href=e.system_requirements_link):alert(e.errors_text)))},error:function(){}})},patch_action:function(e,t){a.ajax({url:XStorePanelPatcherConfig.ajaxurl,method:"POST",data:{action:"xstore_apply_patch",theme_version:e.data("theme_version"),test_mode:XStorePanelPatcherConfig.test_mode,_nonce:XStorePanelPatcherConfig.nonce,patch_id:t,files:e.data("files")},dataType:"json",beforeSend:function(){},complete:function(){e.removeClass("loading"),n.successfully_applied&&(e.parent().html(XStorePanelPatcherConfig.applied_btn),n.patches_wrapper.find('.required-patch[data-required_patch="'+t+'"]').length)&&setTimeout(function(){window.location.reload()},2e3)},success:function(e){if(e.success)n.successfully_applied=!0;else if(e.status&&"success"!=e.status)alert(e.message);else if(e.errors.server_errors)alert(e.server_errors_text+"\n"+e.errors.server_errors.join("\n"));else{let a=[];var t=Object.keys(e.errors);t.length?(t.forEach(function(t){e.errors[t].forEach(function(e){a.push(t+"/"+e)})}),confirm(e.errors_text+"\n"+a.join("\n"))&&(window.location.href=e.system_requirements_link)):alert(e.errors_text)}},error:function(){}})},apply_patch:function(t,r){r.preventDefault(),t.addClass("loading"),n.successfully_applied=!1;r=t.data("patch_id");if("all"==r)confirm(XStorePanelPatcherConfig.apply_all+"\n\n"+XStorePanelPatcherConfig.backup_info)?(n.patches_wrapper.addClass("loading"),n.patch_action_all(t)):t.removeClass("loading");else{let e=t.data("files"),a=[];Object.keys(e).forEach(function(t){e[t].forEach(function(e){Object.values(e).forEach(function(e){a.push(t+"/"+e)})})}),confirm(XStorePanelPatcherConfig.question+"\n\n"+(1<a.length?XStorePanelPatcherConfig.files_will_modify.replace("{{files}}","\n"+a.join("\n")):XStorePanelPatcherConfig.file_will_modify.replace("{{file}}","\n"+a.join("\n"))))?n.patch_action(t,r):t.removeClass("loading")}},load_patches:function(e,t){t.preventDefault(),e.parents(".etheme-patcher-list").find("tbody").find("tr:not(.hidden)").last().nextAll("tr:lt(5)").removeClass("hidden"),e.removeClass("loading"),e.parents(".etheme-patcher-list").find("tbody").find("tr.hidden").length||e.parent().remove()},refresh_patches:function(e,t){a.ajax({url:XStorePanelPatcherConfig.ajaxurl,method:"POST",data:{action:"xstore_refresh_patches",security:e.data("nonce")},dataType:"json",beforeSend:function(){},complete:function(){window.location.reload()},success:function(){},error:function(){}})}},e=(window.et_panel=Object.assign(window.et_panel,n),{1:{selector:".etheme-patcher-list .apply-patch[data-patch_id]",type:"click",callback:et_panel.apply_patch},2:{selector:".refresh-patches",type:"click",callback:et_panel.refresh_patches},3:{selector:".etheme-patcher-list .load-patches",type:"click",callback:et_panel.load_patches}});a.each(e,function(e,t){"ready"==t.type?a(document).ready(function(e){t.callback(a(this),e)}):a(t.selector).on(t.type,function(e){t.callback(a(this),e)})})})}(jQuery,window.et_panel);