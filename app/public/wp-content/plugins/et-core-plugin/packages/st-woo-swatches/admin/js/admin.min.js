var $=jQuery.noConflict(),ST_WC_SWATCH=ST_WC_SWATCH||{};!function(n){"use strict";ST_WC_SWATCH.colorSwatch=function(){n(".st-color-swatch-picker").wpColorPicker()},ST_WC_SWATCH.imageSwatch=function(){var o;n("body").on("click",".st-image-swatch-picker",function(t){t.preventDefault();var a=n(this);o||(o=wp.media({title:a.data("title"),multiple:!1,library:{type:"image"},button:{text:a.data("button")}})).on("select",function(){var t=o.state().get("selection").first().toJSON(),e=(t.sizes.thumbnail||t).url,t=t.id,e='<div class="st-image-swatch-image"><img src="'+e+'" /><a href="javascript:void(0);" class="st-image-swatch-image-remove" title="'+a.data("remove")+'"></a></div>';(a.hasClass("attribute-screen")?(a.siblings("input.st-image-swatch-id").val(t),a.parent().prev(".st-image-swatch-image-holder")):(n("#st-term-modal-container").find("input.st-image-swatch-id").val(t),n("#st-term-modal-container").find(".st-image-swatch-image-holder"))).append(e),setTimeout(function(){a.addClass("hidden")},10)}),o.open()}),n("body").on("click",".st-image-swatch-image-remove",function(t){t.preventDefault();var t=n(this),e=t.parent(),a=t.parents(".st-image-swatch-image-holder").next(".st-image-swatch-holder").find("input.st-image-swatch-id");t.parents(".st-image-swatch-image-holder").next(".st-image-swatch-holder").find("button.st-image-swatch-picker").removeClass("hidden"),a.val(""),e.remove()})},ST_WC_SWATCH.termModalbox={init:function(){var t=n("#st-term-modal-container");ST_WC_SWATCH.termModalbox.openModal(t),ST_WC_SWATCH.termModalbox.closeModal(t),ST_WC_SWATCH.termModalbox.addTerm(t)},openModal:function(a){n("body").on("click",".st-add-new-attribute",function(t){t.preventDefault();var t=n(this),e=wp.template("st-input-term-tax"),t={tax:t.closest(".woocommerce_attribute").data("taxonomy"),type:t.data("type")};t.type=t.type.replace("-sq",""),a.find(".st-term-swatch").html(n("#tmpl-"+t.type).html()),a.find(".st-term-tax").html(e(t)),"st-color-swatch"==t.type&&a.find(".st-color-swatch-picker").wpColorPicker(),a.show()})},closeModal:function(e){n("body").on("click","#st-term-modal-container .media-modal-close, #st-term-modal-container .media-modal-backdrop, #st-term-modal-container .st-term-cancel",function(t){t.preventDefault(),e.find(".st-term-name, .st-term-slug").val(""),e.find(".st-term-insert").html(e.find(".st-term-insert").data("label")),e.hide()})},addTerm:function(s){n("body").on("click","#st-term-modal-container .st-term-insert",function(t){t.preventDefault();var a=n(this),e=!1,o={};s.find(".st-term-input").each(function(){var t=n(this);"slug"==t.attr("name")||t.val()?t.removeClass("error"):(t.addClass("error"),e=!0),o[t.attr("name")]=t.val()}),e||wp.ajax.send("stwc_add_new_term",{data:o,beforeSend:function(t){a.html('<span class="button-dot-loader"> <span class="dot dot-1"></span> <span class="dot dot-2"></span> <span class="dot dot-3"></span> </span>')},error:function(t){a.html('<span class="'+t.btn_span+'"> </span>'),alert(t.msg),a.html(t.btn_txt)},success:function(t){var e=n(".st-add-new-attribute").closest(".woocommerce_attribute.wc-metabox").find("select.attribute_values");e.append('<option value="'+t.id+'" selected="selected">'+t.name+"</option>"),e.change(),a.html(t.btn_txt),s.find(".media-modal-close").trigger("click")}})})}},ST_WC_SWATCH.documentOnReady={init:function(){ST_WC_SWATCH.colorSwatch(),ST_WC_SWATCH.imageSwatch(),ST_WC_SWATCH.termModalbox.init()}},ST_WC_SWATCH.ajaxComplete=function(t,e,a){if(a.hasOwnProperty("data")&&(0<=a.data.indexOf("st-image-swatch")||0<=a.data.indexOf("st-color-swatch"))){if(e&&4===e.readyState&&200===e.status&&a.data&&0<=a.data.indexOf("action=add-tag")){e=wpAjax.parseAjaxResponse(e.responseXML,"ajax-response");if(!e||e.errors)return}0<=a.data.indexOf("st-image-swatch")&&(n("button.st-image-swatch-picker").removeClass("hidden"),n("input.st-image-swatch-id").val(""),n(".st-image-swatch-image-holder").html("")),0<=a.data.indexOf("st-color-swatch")&&(n(".wp-color-result").removeAttr("style"),n(".wp-color-result").trigger("click"))}},n(document).ready(ST_WC_SWATCH.documentOnReady.init),n(document).ajaxComplete(ST_WC_SWATCH.ajaxComplete),n(document).on("click",".et-swatch-add-color",function(t){var e="colorpicker-"+Math.floor(900*Math.random()+100);n(this).parent().before('<p><input type="text" id="'+e+'" class="st-color-swatch-picker" name="st-color-swatch[]" value=""/><span class="et-button et-button-active no-loader last-button et-color-swatch-picker-remove"><span class="dashicons dashicons-no-alt"></span></span></p>'),n(document).find("#"+e).wpColorPicker()}),n(document).on("click",".et-color-swatch-picker-remove",function(t){n(document).find(".et-color-swatch-picker-remove").length<2?alert("You can not remove the last color!"):n(this).parents("p").remove()})}(jQuery);